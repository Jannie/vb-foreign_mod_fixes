# This patch file was generated by NetBeans IDE
# This patch can be applied using context Tools: Apply Diff Patch action on respective folder.
# It uses platform neutral UTF-8 encoding.
# Above lines and this line are ignored by the patching process.
--- /home/varnak/work/php/vb/tmp/ame/upload/includes/ame_prep.php
+++ /home/varnak/work/php/vb/vb4/includes/ame_prep.php
@@ -553,8 +553,11 @@
 				{
 					
 					$text = preg_replace('%(\[(quote|php|html|code|nomedia)([^\]]*)\](.*?)\[/(\2)\])%sime', '$this->substitute(\'\1\', $this->_subbed)', $text);
-					$text = preg_replace($info['find'], $info['replace'], $text);
+//					$text = preg_replace($info['find'], $info['replace'], $text);
 				
+                    $text = preg_replace($info['find_opt'], $info['replace'], $text);
+                    $text = preg_replace($info['find_simple'], $info['replace'], $text);
+
 				}
 		
 				if (sizeof($this->_subbed))
@@ -596,6 +599,7 @@
 				
 			}
 			
+			$url_tail = '[\w:\/?\[\]@!$&\'()*+.,;="%\-]*';
 			
 			if (!is_array($info)) 
 			{
@@ -609,9 +613,11 @@
 				{
 					
 					$info['providers']["$result[tagoption]"] 	= $result;			
-					$info['find'][] 							= "#\[url(?:\]|=\"?)($result[regex_url][&\w;=\+_\-]*)(?:\"?\](?:.*?))?\[/url\]#im";
+//					$info['find'][] 							= "#\[url(?:\]|=\"?)($result[regex_url][&\w;=\+_\-\%\.\,\#]*)(?:\"?\](?:.*?))?\[/url\]#im";
 					$info['replace'][] 							= "[video]\\1[/video]";
 					
+                    $info['find_opt'][] 						= '#\[url=\"?(' . $result['regex_url'] . $url_tail . ')(?:\"?\])+(?:.*?)\[\/url\]#im';
+                    $info['find_simple'][] 						= '#\[url\](' . $result['regex_url'] . $url_tail . ')\[\/url\]#im';
\ No newline at end of file
 				}
 				
 			}
